version: 2.1
orbs: 
  maven: circleci/maven@1.4.0
jobs: 
  maven_build:
    machine: 
      image: ubuntu-2004:202010-01
    steps:
      - checkout
      - run:
          name: Install Sonarqube scanner
          command: |
            wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.8.0.2856-linux.zip
            unzip sonar-scanner-cli-4.8.0.2856-linux.zip
      - run:
          name: Run Sonarscanner
          command: |
            export SONAR_SCANNER_OPTS="-Xmx2048m"
            mvn clean test || true
            mvn sonar:sonar \ -Dsonar.projectKey=OCA \ -Dsonar.host.url=https://sonar.deloittedigital.studio \ -Dsonar.login=2fe128d617d5f2740b8446d16ae24e05a8307c7f

workflows:
  build:
    jobs:
      - maven_build
  
